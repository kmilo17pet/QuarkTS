<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>OS: Fundamentals</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/kmilo17pet/QuarkTS" class="github-corner" title="View source on GitHub" target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="quarktslogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OS
   &#160;<span id="projectnumber">v7.3.3</span>
   </div>
   <div id="projectbrief">Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('q_foundations.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Fundamentals </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#rtcmodel">RTC(Run To Completion) model</a></li>
<li class="level1"><a href="#q_timmingapproach">Timing Approach</a></li>
<li class="level1"><a href="#q_tasks">Tasks</a><ul><li class="level2"><a href="#q_idletask">The idle task</a></li>
<li class="level2"><a href="#q_addtasks">Adding tasks to the scheme</a></li>
<li class="level2"><a href="#q_eventtasks">Event-triggered tasks</a></li>
<li class="level2"><a href="#q_removetask">Removing a task</a></li>
</ul>
</li>
<li class="level1"><a href="#q_runos">Running the OS</a><ul><li class="level2"><a href="#q_releasescheduler">Releasing the scheduler</a></li>
</ul>
</li>
<li class="level1"><a href="#q_globalstates">Global states and scheduling rules</a><ul><li class="level2"><a href="#q_osrules">Rules</a><ul><li class="level3"><a href="#q_os_evenprecedence">Event precedence</a></li>
<li class="level3"><a href="#q_os_operational_states">Additional operational states</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#q_critical">Critical sections</a></li>
<li class="level1"><a href="#q_configmacros">Configuration macros</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="rtcmodel"></a>
RTC(Run To Completion) model</h1>
<p >In this pattern each task runs until it finishes or explicitly yields control back to the scheduler. Events are serviced by the kernel in the scheduler loop. If an event is available, it is posted to the task based on the scheduling <a class="el" href="q_foundations.html#q_osrules">rules</a>, and then the dispatcher triggers the task. The task executes the actions associated with that event and then returns to the scheduler.</p>
<p >This pattern means that in the absence of exceptions or asynchronous destruction of the task execution, a pending event occurrence is dispatched only after the processing of the previous occurrence is completed, and a stable task-scheme configuration has been reached. That is, an event occurrence will never be dispatched while the task execution is busy processing the previous one. This behavioral paradigm was chosen to avoid complications arising from concurrency conflicts that may occur when a task tries to respond to multiple concurrent or overlapping events. This also provides better power efficiency. In the absence of events, the developer can use CPU low-power modes and make the core active only during the execution of a RTC step.</p>
<p >The provided features enables you to implement task procedures that does not have to execute all the way down to the last line of code. Instead execution can be broken down into different entities by using <a class="el" href="q_fsm.html">Finite State Machines (FSM)</a> or by using <a class="el" href="q_qcoroutines.html">Co-Routines</a> where the procedure execution can be suspended and resumed at defined locations.</p>
<h1><a class="anchor" id="q_timmingapproach"></a>
Timing Approach</h1>
<p >The kernel implements a <a href="https://en.wikipedia.org/wiki/Time-triggered_architecture" style="font-weight:bold">Time-Triggered Architecture (TTA)</a> , in which the tasks are triggered by comparing the corresponding task-time with a reference clock. The reference clock must be real-time and follow a monotonic behavior. Usually, all embedded systems can provide this kind of reference with a constant tick generated by a periodic background hardware-timer, typically, at <code>1Khz</code> or <code>1mS</code> tick.</p>
<p >For this, the kernel allows you to select the reference clock source among these two scenarios:</p>
<ul>
<li><b>When tick already provided</b>: The reference is supplied by the Hardware Abstraction Layer (HAL) of the device. It is the simplest scenario and it occurs when the framework or SDK of the embedded system includes a HAL-API that provides the time elapsed since the system starts, usually in milliseconds by returning a 32-bit counter variable.</li>
<li><b>When the tick is not provided</b>: The application writer should use bare-metal code to configure the device and feed the reference clock manually. Here, a hardware timer should raise an interrupt periodically. After the <em>Interrupt Service Routine(ISR)</em> has been implemented using the platform-dependent code, the <a class="el" href="group__qclock.html#gacdc3d27983dcc08e28d9eb9844a55c53" title="Feed the system tick.">qClock_SysTick()</a> API must be called inside. It is recommended that the reserved ISR should only be used by QuarkTS.</li>
</ul>
<p >The initialization and configuration of QuarkTS through <a class="el" href="group__qtaskcreation.html#gac97ca3bd669135e0adcf07fcc2852313" title="Task Scheduler Setup. This function is required and must be called once in the application main threa...">qOS_Setup()</a> will allow you to set the reference clock source in addition to specifying <a class="el" href="q_foundations.html#q_idletask">Idle task</a> activities.</p>
<dl class="section note"><dt>Note</dt><dd>The call to <a class="el" href="group__qtaskcreation.html#gac97ca3bd669135e0adcf07fcc2852313" title="Task Scheduler Setup. This function is required and must be called once in the application main threa...">qOS_Setup()</a> is mandatory and must be called once in the application main thread before any kind of interaction with the other OS functions.</dd></dl>
<p>Usage example:</p><ul>
<li>Scenario 1 : When tick is already provided <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;QuarkTS.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;HAL.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define TIMER_TICK 0.001 </span><span class="comment">/* 1ms */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> main( <span class="keywordtype">void</span> ) {</div>
<div class="line">    HAL_Init();</div>
<div class="line">    <a class="code hl_function" href="group__qtaskcreation.html#gac97ca3bd669135e0adcf07fcc2852313">qOS_Setup</a>( HAL_GetTick , TIMER_TICK , IdleTask_Callback );</div>
<div class="line">    <span class="comment">// TODO: add Tasks to the scheduler scheme and run the OS</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__qtaskcreation_html_gac97ca3bd669135e0adcf07fcc2852313"><div class="ttname"><a href="group__qtaskcreation.html#gac97ca3bd669135e0adcf07fcc2852313">qOS_Setup</a></div><div class="ttdeci">qBool_t qOS_Setup(const qGetTickFcn_t tFcn, const qTimingBase_t t, qTaskFcn_t idleCallback)</div><div class="ttdoc">Task Scheduler Setup. This function is required and must be called once in the application main threa...</div><div class="ttdef"><b>Definition:</b> qkernel.c:126</div></div>
</div><!-- fragment --></li>
<li>Scenario 2 : When the tick is not provided <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;QuarkTS.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;DeviceHeader.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define TIMER_TICK       ( 0.001f ) </span><span class="comment">/* 1ms */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Interrupt_Timer0( <span class="keywordtype">void</span> ) {</div>
<div class="line">    <a class="code hl_function" href="group__qclock.html#gacdc3d27983dcc08e28d9eb9844a55c53">qClock_SysTick</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> main( <span class="keywordtype">void</span> ) {</div>
<div class="line">    MCU_Init();</div>
<div class="line">    HAL_Init();</div>
<div class="line">    <a class="code hl_function" href="group__qtaskcreation.html#gac97ca3bd669135e0adcf07fcc2852313">qOS_Setup</a>( NULL , TIMER_TICK , IdleTask_Callback );</div>
<div class="line">    <span class="comment">// TODO: add Tasks to the scheduler scheme and run the OS</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__qclock_html_gacdc3d27983dcc08e28d9eb9844a55c53"><div class="ttname"><a href="group__qclock.html#gacdc3d27983dcc08e28d9eb9844a55c53">qClock_SysTick</a></div><div class="ttdeci">void qClock_SysTick(void)</div><div class="ttdoc">Feed the system tick.</div><div class="ttdef"><b>Definition:</b> qclock.c:94</div></div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="q_tasks"></a>
Tasks</h1>
<p >Like many operating systems, the basic unit of work is the task. Tasks can perform certain functions, which could require periodic or one-time execution, update specific variables or wait for specific events. Tasks also could be controlling specific hardware or be triggered by hardware interrupts. In the QuarkTS OS, a task is seen as a node concept that links together:</p>
<ul>
<li>Program code performing specific task activities (callback function)</li>
<li>Execution interval (time)</li>
<li>Number of execution (iterations)</li>
<li>Event-based data</li>
</ul>
<p >The OS uses a <b>Task Control Block (TCB)</b> to represent each task, storing essential information about task management and execution. Part of this information also includes link-pointers that allow it to be part of one of the lists available in the <b>Kernel Control Block (KCB)</b>.</p>
<center>  
  <!DOCTYPE html>
  <html>
  <head>
  <title>tasknode</title>
  <meta charset="utf-8"/>
  </head>
  <body><div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2022-10-18T13:11:02.654Z\&quot; agent=\&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36\&quot; etag=\&quot;QycpXy9CV1RyLdRAMmhi\&quot; version=\&quot;20.2.2\&quot; type=\&quot;google\&quot;&gt;&lt;diagram id=\&quot;Wp6tzC3tOU-Ykbh8yUCR\&quot; name=\&quot;Página-1\&quot;&gt;7VtRb5s6FP41eZm0CHBoyGOTNrfSuulqne62Rw/c4NXBEThNcn/9tcEOYENC2gTQbtpKxQfbsc/3HfvwmQzAbLn9K4ar8DMNEBk4VrAdgLuB49jAdvk/YdlJi+14mWUR40DacsMT/hdJoyWtaxygpFSRUUoYXpWNPo0i5LOSDcYx3ZSrPVNS/tQVXCDD8ORDYlq/44CFaho3k/zGA8KLUH6054yzG0uoKsuZJCEM6KZgAvcDMIspZdnVcjtDRHhP+SVrN6+5ux9YjCLWpMEo+riZh8t/vpCnr3SC0G/iPXyUvbxCspYTloNlO+WBmK6jAIlOrAGYbkLM0NMK+uLuhoPObSFbEl6y+eUzJmRGCY3TtsCyxvP5XNhpxAr27IfbExbTF1TZgvf0JEcRQuaHspc5XGIi2PSAyCti2If7bhRA3LVTOS8UM7StdZi9h4ETGNElYvGOV1ENJhI5xV0HZOVNkQiyTljggEIcSu4t9l3n8PALidAJaDkGWhGPOG4hOHpJ3ofcYSSUPaIRMuH0LPEr7Qo0u3vARl0DBgzA+MpCfkH/5QqWDtZN12CNDLBwxFDMy1ewdLC8rsFyTbA4VpBhGl0XQh0ux+oarhsDLspCFItsDiYvIkGEDA6Hwyt0OnSdJx3ja4pYixYAx1NEr02wvDODdXJEdej7imyvyve2dSnnT66RUouW17NAUUtoARsU8Cd/WaQxC+mCRpDc59ZpGb28ziOlK4nZb8TYTsoYcM1oGVG0xexH4fqn7Epc322LhZ0qRHy2P4qFn8VC3igtqVYHmFCHur+OX9Op2QcoIFx0mADco3Qd++iQ65WOA+MFYgcqOtWMihHhed5reSDnJ8i5pZEeL6V6cHa+ktqm0mGGaxTcCoGPl3wCkwT7ZX+XwblGXq4fHQ08r5otBTq4FXRQtsbxKT/hb8qfswv7+kjLgMeg3EU2TdmqKHjqHdk1tFYdZX4wOkoZu5/2O0hsqj/vJbGipF2i5NBxj7BSsd8qsl82qw2A7qjcFfVqNalTqWffHOno0tQztazLUK/Hq+HRVQ50usrpTy9vpRrQqea2TDVTiXtfnlSRDb2BRm3kSeOun2FMVW37iBPWsv/7J6JpOLld49RAQjtPItA0D2ieBfc6n500XOmzQOlqqXfGZTpO3rrSO+V+GqaznFZwV6i2EhWSE5IgmcfWDcuxKlfFPGCyAZx302mgc176+bDXkdFtGq0R3gZnSqMbZtGnMt6ZVAZoLeFHHRC+gbZcILzctw/sH8EcixH8idwfd8n9kZZ7OP2mPjiR+l7lqC5KfbXrXdf6Pqp1Iy0p2b8ZcirhR67WUctqndNA738bzawz0Gz/8qjVwVFNZxqJllkCnRKNudUxtZxWqDU8LOfWnGccF4+1Y+jARV4w6iVbpR5y9Hlw8iey+lIpgntoyz8aalYbGYJ50LL9lr5WpgUZQ1tmEFeduJqyFyR4EfEiQc+imZCk+N5ObqV5iYMgfS0gWUEfR4vHtNrdKLd8leQRJsqbP5M0KkLeEPEeptL1fGzulP9x181EFLt8rDNetvMy/xPVYzajER8+xGlsIJiwDUpYuj4wyOCvdKZWMQSV+lan0lUmL+XV5iIanaMnDiosjqh0Sjc//8v15pnJh0+z6QDccuMnFEeIDGbO4JZ/vsVR4D4RXU4JFS9z85VHHDeC6YdvqknGQLPqlZN31gFOlqnXrm6sP94AUzjeq13tcPL/e7hS4ftWRXvHPFwRq8E1fPu7pdiWvqVcakfhxfyLe1kak3//Edz/Bw==&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}"></div>
  <script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>
  </body>
  </html>
   <em>Task node illustration</em> </center><p >Each task performs its activities via a <em>callback</em> function and each of them is responsible for supporting cooperative multitasking by being “good neighbors”, i.e., running their callback methods quickly in a non-blocking way and releasing control back to the scheduler as soon as possible (returning).</p>
<p >Every task node, must be defined using the <a class="el" href="structq_task__t.html" title="A task node object.">qTask_t</a> data type and the callback is defined as a function that returns void and takes a <a class="el" href="structq_event__t.html" title="The task argument with all the regarding information of the task execution.">qEvent_t</a> data structure as its only parameter (This input argument can be used later to get the event information, see <a class="el" href="q_events.html#eventdata">Retrieving the event data</a>).</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structq_task__t.html">qTask_t</a> UserTask;</div>
<div class="line"><span class="keywordtype">void</span> UserTask_Callback( <a class="code hl_struct" href="structq_event__t.html">qEvent_t</a> eventdata ) {</div>
<div class="line">    <span class="comment">// TODO : Task code</span></div>
<div class="line">}</div>
<div class="ttc" id="astructq_event__t_html"><div class="ttname"><a href="structq_event__t.html">qEvent_t</a></div><div class="ttdoc">The task argument with all the regarding information of the task execution.</div><div class="ttdef"><b>Definition:</b> qtasks.h:162</div></div>
<div class="ttc" id="astructq_task__t_html"><div class="ttname"><a href="structq_task__t.html">qTask_t</a></div><div class="ttdoc">A task node object.</div><div class="ttdef"><b>Definition:</b> qtasks.h:268</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>All tasks in QuarkTS must ensure their completion to return the CPU control back to the scheduler to follow the <a class="el" href="q_foundations.html#rtcmodel">RTC(Run To Completion) model</a>, otherwise, the scheduler will hold the execution state for that task, preventing the activation of other tasks.</dd></dl>
<h2><a class="anchor" id="q_idletask"></a>
The idle task</h2>
<p >It's a special task loaded by the OS scheduler when there is nothing else to do (no task in the whole scheme has reached the ready state). The idle task is already hard-coded into the kernel, ensuring that at least, one task is able to run. Additionally, the OS setup this task with the lowest possible priority to ensure that does not use any CPU time if there are higher priority application tasks able to run. The idle task doesn't perform any active functions, but the user can decide if it should perform some activities defining a callback function for it. This could be done at the beginning of the kernel setup. Of course, the callback must follow the same function prototype for tasks. </p><dl class="section note"><dt>Note</dt><dd>To disable the idle-task activities, a <code>NULL</code> should be passed as argument on <a class="el" href="group__qtaskcreation.html#gac97ca3bd669135e0adcf07fcc2852313" title="Task Scheduler Setup. This function is required and must be called once in the application main threa...">qOS_Setup()</a> or <a class="el" href="group__qtaskcreation.html#gaa5dcfef5ef874146d424997f78fc5def" title="Set/Change the callback for the Idle-task.">qOS_Set_IdleTask()</a>.</dd></dl>
<h2><a class="anchor" id="q_addtasks"></a>
Adding tasks to the scheme</h2>
<p >After setting up the kernel with <a class="el" href="group__qtaskcreation.html#gac97ca3bd669135e0adcf07fcc2852313" title="Task Scheduler Setup. This function is required and must be called once in the application main threa...">qOS_Setup()</a>, the user can proceed to deploy the multitasking application by adding tasks. If the task node and their respective callback is already defined, the task can be added to the scheme using <a class="el" href="group__qtaskcreation.html#ga261c858990773b834e8129940ceef1e2" title="Add a task to the scheduling scheme. The task is scheduled to run every t seconds,...">qOS_Add_Task()</a>. This API can schedule a task to run every <code>t</code> seconds, <code>n</code> executions times and invoking the <code>callbackFcn</code> method on every pass.</p>
<p ><b> Caveats: </b></p>
<ol type="1">
<li>A task with time argument <code>t</code> defined as <code>qTimeImmediate</code>, will always get the <code>qReady</code> state in every scheduling cycle, as consequence, the idle task will never get dispatched.</li>
<li>Tasks do not remember the number of iterations set initially by the <code>n</code> executions argument. After the iterations are done, the internal iteration counter decreases until reaches zero. If another set of iterations is needed, the user should set the number of iterations again and resume the task explicitly.</li>
<li>Tasks that performed all their iterations, put their own state to <code>qDisabled</code>. Asynchronous triggers do not affect the iteration counter.</li>
<li>The <code>arg</code> parameter can be used as a storage pointer, so, for multiple data, create a structure with the required members and pass a pointer to that structure.</li>
</ol>
<p >Invoking <a class="el" href="group__qtaskcreation.html#ga261c858990773b834e8129940ceef1e2" title="Add a task to the scheduling scheme. The task is scheduled to run every t seconds,...">qOS_Add_Task()</a> is the most generic way to add tasks to the scheme, supporting a mixture of time-triggered and event-triggered tasks, however, additional simplified API functions are also provided to add specific purpose tasks:</p>
<ul>
<li>Event-triggered only tasks → <a class="el" href="group__qtaskcreation.html#gae296358ea4dd26df7018155eef0cb456" title="Add a task to the scheduling scheme. This API creates a task with a qDisabled state by default,...">qOS_Add_EventTask()</a>.</li>
<li>State-machine tasks → <a class="el" href="group__qtaskcreation.html#gaeea76a6e287011694689c658f7e204ca" title="Add a task to the scheduling scheme running a dedicated state-machine. The task is scheduled to run e...">qOS_Add_StateMachineTask()</a>.</li>
<li>AT Command Line Interface tasks → <a class="el" href="group__qtaskcreation.html#gaf0b51d7213c21c0afbfd4dbce865c6e2" title="Add a task to the scheduling scheme running an AT Command Line Interface. Task will be scheduled as e...">qOS_Add_ATCLITask()</a>.</li>
</ul>
<h2><a class="anchor" id="q_eventtasks"></a>
Event-triggered tasks</h2>
<p >An event-triggered task reacts asynchronously to the occurrence of events in the system, such as external interrupts or changes in the available resources.</p>
<p >The API <a class="el" href="group__qtaskcreation.html#gae296358ea4dd26df7018155eef0cb456" title="Add a task to the scheduling scheme. This API creates a task with a qDisabled state by default,...">qOS_Add_EventTask()</a> is intended to add this kind of tasks, keeping it in a <code>qSuspended</code> state. Only asynchronous events followed by their priority value dictate when a task can change to the <code>qRunning</code> state.</p>
<h2><a class="anchor" id="q_removetask"></a>
Removing a task</h2>
<p >The <a class="el" href="group__qtaskcreation.html#ga4d3b11b689fa9df89cf8ac4023482765" title="Remove the task from the scheduling scheme.">qOS_Remove_Task()</a> function removes the task from the scheduling scheme. This means the task node will be disconnected from the kernel chain, preventing additional overhead provided by the scheduler when it does checks over it and course, preventing it from running.</p>
<p ><b> Caveats: </b></p>
<p >Task nodes are variables like any other. They allow your application code to reference a task, but there is no link back the other way and the kernel doesn't know anything about the variables, where the variable is allocated (stack, global, static, etc.) or how many copies of the variable you have made, or even if the variable still exists. So the <a class="el" href="group__qtaskcreation.html#ga4d3b11b689fa9df89cf8ac4023482765" title="Remove the task from the scheduling scheme.">qOS_Remove_Task()</a> API cannot automatically free the resources allocated by the variable. If the task node has been dynamically allocated, the application writer it's responsible to free the memory block after a removal call.</p>
<h1><a class="anchor" id="q_runos"></a>
Running the OS</h1>
<p >After preparing the multitasking environment for your application, a call to <a class="el" href="group__qtaskcreation.html#gabd4b43371d39c5eb82b87f0900f2895a" title="Executes the scheduling scheme. It must be called once after the task pool has been defined.">qOS_Run()</a> is required to execute the scheduling scheme. This function is responsible to run the following OS main components:</p>
<ul>
<li><b>The Scheduler</b> : Select the tasks to be submitted into the system and decide with of them are able to run.</li>
<li><b>The Dispatcher</b> : When the scheduler completes its job of selecting ready tasks, it is the dispatcher which takes that task to the running state. This procedure gives a task control over the CPU after it has been selected by the scheduler. This involves the following:<ol type="1">
<li>Preparing the resources before the task execution</li>
<li>Execute the task activities (via the callback function)</li>
<li>Releasing the resources after the task execution</li>
</ol>
</li>
</ul>
<p >The states involved in the interaction between the scheduler and dispatcher are described <a class="el" href="q_foundations.html#q_globalstates">here</a>.</p>
<dl class="section note"><dt>Note</dt><dd>After calling <a class="el" href="group__qtaskcreation.html#gabd4b43371d39c5eb82b87f0900f2895a" title="Executes the scheduling scheme. It must be called once after the task pool has been defined.">qOS_Run()</a>, the OS scheduler will now be running, and the following line should never be reached, however, the user can optionally release it explicitly with <a class="el" href="group__qtaskcreation.html#ga7ab61e7b82c7d42ec83368c76bcbd9f2" title="Disables the kernel scheduling. The main thread will continue after the qOS_Run() call.">qOS_Scheduler_Release()</a> API function.</dd></dl>
<h2><a class="anchor" id="q_releasescheduler"></a>
Releasing the scheduler</h2>
<p >This functionality must be enabled from the <code>Q_ALLOW_SCHEDULER_RELEASE</code> macro. This API stops the kernel scheduling. In consequence, the main thread will continue after the <a class="el" href="group__qtaskcreation.html#gabd4b43371d39c5eb82b87f0900f2895a" title="Executes the scheduling scheme. It must be called once after the task pool has been defined.">qOS_Run()</a> call.</p>
<p >Although producing this action is not a typical desired behavior in any application, it can be used to handle a critical exception.</p>
<p >When used, the release will take place after the current scheduling cycle finishes. The kernel can optionally include a release callback function that can be configured to get called if the scheduler is released. Defining the release callback, will help to take actions over the exception that caused the release action. To perform a release action, the <a class="el" href="group__qtaskcreation.html#ga8bf2fd6a232425e00427e58d8894a475" title="Set/Change the scheduler release callback function.">qOS_Set_SchedulerReleaseCallback()</a> API should be used</p>
<dl class="section note"><dt>Note</dt><dd>When a scheduler release is performed, resources are not freed. After released, the application can invoke the <a class="el" href="group__qtaskcreation.html#gabd4b43371d39c5eb82b87f0900f2895a" title="Executes the scheduling scheme. It must be called once after the task pool has been defined.">qOS_Run()</a> again to resume the scheduling activities</dd></dl>
<h1><a class="anchor" id="q_globalstates"></a>
Global states and scheduling rules</h1>
<p >A task can be in one of the four global states: <code>qRunning</code>, <code>qReady</code>, <code>qSuspended</code> or <code>qWaiting</code>. Each of these states is tracked implicitly by putting the task in one of the associated kernel lists.</p>
<p >These global states are described below:</p>
<center>  
  <!DOCTYPE html>
  <html>
  <head>
  <title>globalstates</title>
  <meta charset="utf-8"/>
  </head>
  <body><div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2022-10-18T13:19:49.977Z\&quot; agent=\&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36\&quot; etag=\&quot;oSuMqHCIxHJLwsXvollB\&quot; version=\&quot;20.2.2\&quot; type=\&quot;google\&quot;&gt;&lt;diagram id=\&quot;yUrP7yZJVmdYKEqsLdOd\&quot; name=\&quot;Página-1\&quot;&gt;7Vtdb+MoFP01eWxljJ3Yj5O03VlpVqqa3Z2ZfRlRm8ZosEkx+dpfv2DjT5wmzThJs0pbqeYaMNx7OFyOkwGcxOvfOJpHf7AQ04FthesBvBvYNoDAlf+UZaMtwPZyy4yTUNsqw5T8i7XR0tYFCXHaqCgYo4LMm8aAJQkORMOGOGerZrUXRptPnaMZNgzTAFHT+pWEIiqmMfSrG58xmUX60Z49ym/EqKisZ5JGKGSrmgneD+CEMybyq3g9wVR5r/BL3u5hy91yYBwnYp8Gzp//IHbz+9pBkx+vfz/N/uI38Y3uZYnoQk94YA+p7G/8LC9m6qIwvDD5HOVoynhWdfi6YHkF6Fnqt27K274+LZKEJLOiDzm6vJtm19Jce1zmLLEpIsDZIgmxmoQlb68iIvB0jgJ1dyVBJ22RiKksAXmZCs5+4kk5RmhZo4eHBzV8QmlhT1iC9YweUEyoAudnTJdYkACVvRTxtstRLTEXeL3V/6CMqlwPmMVY8I2sUjSwNBD0UoA2zMurCle+rhLVEAW1DWkkz8qeq2DLCx3vd8Te7oh9r773s59f9n2I0igbA+gnEF4zDg6wjThA2BEI4IIjRQIakbgj6RyJIMLciImcuDC8XXjVdDSiZJbIIsUvqpnynHQ0/aTNMQlD1fNYPi+QK/VLVu3OqSxP2gPKxGTzF5qxWCQbYtnDeM5IIjKPuGP5Jx03sW7dgSvHOpFlUJXln6rOxYQlcviIZPHCKBUrnKrBcSaQQM/ZTBXgSsoEGjE1cGnKeQNJTfCauFINp9qvoA9cOQ1c2Z65vr1Trm9n9/rGSfhJbZKyFFCUpiRoLukuF3aRaxkoVS1Y8GW5Xk234zUR33RVdf29dn23rheUI21Xlx4xJ9IvmJeDQVwUg9dYz+eHQ2NLb4VQ+oAteIDf2hi3xLoWTLcjmIWNY4oEWTbH0RVh/YRHtYgqKJWgKPYK6DW7yMevW9U3/VZHwN/RkfTiDAujowxw5bQPx6C7G4MFI31Bz5g+spQIwhQzPTMhWNxBWYK1N54IzVVn8XqmstDbZySBfEvRBnMc/uBZWjjOclKgkMMWgpJE4rjIGC0D6Rk15LkoGL6NfJNWahwsa04m925WsweGsUd+M5rApJgyzajDcngsjhka8X19wijcXHetS9m1bH+4My096bY1ulJGj5Thu81kd3RuxvBMxpgu0jnOXHlljQthjfZh1vHMQ5Q3OiFr+FfW6DPR8ECLNszwnpY2Cj2wzhtfkQyhEpeurHEZrGH78GOxBujSP39FA2uv520hec86p4qvxij4OcuGUmsEoe+X4mYRqJRRNec2PZQP6COO7eNp5znEjKN7tDjuoWXWtA698C9D6Bj0J2roXDA/8+9cFmcTP9qn3EsVP4Cp6/7v2SXboPK86sa3+qEbaLeykQ7F/rR007u0upMrHLdOFv2SVJtxZFj45lu9kA3n1i2KFXtlpWJEPTKVvy9TwfMyVQOX5Uvh9xJVyRTbOjo2Ue0h0x6GZ1DH86072Lb79QfoHkF4XnBBuynMOdaB6Gp3BEfuadFlisR9sWWJqO81rF0KuvakuNFZQQhbIAQHghA4LSESwtOC0JSV000qcDxQH5uRk4SZZIOWiNDsfN2TqBBIXKiN9SordMsKZVmntT19xgO0dO+zv4wHpu6NlzhbITX4BSwJc1mysr0sqMJXf+r4FZJngSR02qeY4V6QdNxjQdLUzBOmABljLGoAFJFkQ6sGzSsMLxiGwG+qKw4cnReGtqns95Ue7iW8ATvLIo93nO4xZ9z3WOx9qJzRsQ88uLQ6gt5+BxcJFbSpVdN0sP0Y77ReZuqX5BWq8x57TUgLv364j+d1iz9vSD9wVClDh2N/J6b9c2K6LSW7oHV8+eiYdu1TYNo2MD0NIhwu6PVzzJfzlrZ8TVJAB5757GT3/R7lQr+p0HWI7f6mAniD4LaEQhar7yLlhFB9pQve/wc=&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}"></div>
  <script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>
  </body>
  </html>
   <em>Task global states</em> </center><ul>
<li><code>qWaiting</code> : The task cannot run because the conditions for running are not in place.</li>
<li><code>qReady</code> : The task has completed preparations for running, but cannot run because a task with higher precedence is running.</li>
<li><code>qRunning</code> : The task is currently being executed.</li>
<li><code>qSuspended</code> : The task doesn't take part in what is going on. Normally this state is taken after the <code>qRunning</code> state or when the task does not reach the <code>qReady</code> state.</li>
</ul>
<p >The presence of a task in a particular list indicates the task's state. There are many ready lists as defined in the <code>Q_PRIORITY_LEVELS</code> macro. To select the target ready list, the OS uses the user-assigned priority between 0 (the lowest priority) and <code>Q_PRIORITY_LEVELS-1</code> (the highest priority). For instance, if <code>Q_PRIORITY_LEVELS</code> is set to 5, then QuarkTS will use 5 priority levels or ready lists: 0 (lowest priority), 1, 2, 3, and 4 (highest priority).</p>
<center>  
  <!DOCTYPE html>
  <html>
  <head>
  <title>oslist</title>
  <meta charset="utf-8"/>
  </head>
  <body><div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2022-10-18T13:21:59.751Z\&quot; agent=\&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36\&quot; etag=\&quot;qu1SGjoOBtXo91H1rG-O\&quot; version=\&quot;20.2.2\&quot; type=\&quot;google\&quot;&gt;&lt;diagram id=\&quot;a3gmjD7FvNUACDKGX7UC\&quot; name=\&quot;Página-1\&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}"></div>
  <script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>
  </body>
  </html>
   <em>OS lists</em> </center><p >Except for the idle task, a task exists in one of these states. As the real-time embedded system runs, each task moves from one state to another (moving it from one list to another), according to the logic of a simple finite state machine (FSM). The figure above illustrates the typical flowchart used by QuarkTS to handle the task's states, with brief descriptions of the state transitions, additionally you may also notice the interaction between the scheduler and the dispatcher.</p>
<p >The OS assumes that none of the tasks does a block anywhere during the <code>qRunning</code> state. Based on the round-robin fashion, each ready task runs in turn from every ready list. The developer should take care to monitor their system execution times to make sure during the worst case, when all tasks have to execute, all of the deadlines are still met.</p>
<h2><a class="anchor" id="q_osrules"></a>
Rules</h2>
<p >Task precedence is used as the task scheduling rule and precedence among tasks is determined based on the priority of each task. If there are multiple tasks able to run, the one with the highest precedence goes to <code>qRunning</code> state first.</p>
<p >In determining precedence among tasks of those tasks having different priority levels, that with the highest priority has the highest precedence. Among tasks having the same priority, the one that entered the scheduling scheme first has the highest precedence if the <code>Q_PRESERVE_TASK_ENTRY_ORDER</code> configuration is enabled, otherwise, the OS will reserves for himself the order according to the dynamics of the kernel lists.</p>
<h3><a class="anchor" id="q_os_evenprecedence"></a>
Event precedence</h3>
<p >The scheduler also has an order of precedence for incoming events, in this way, if events of different natures converge to a single task, these will be served according to the following flowchart:</p>
<center>  
  <!DOCTYPE html>
  <html>
  <head>
  <title>evenprecedence</title>
  <meta charset="utf-8"/>
  </head>
  <body><div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;zoom&quot;:1.45,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2022-10-18T13:23:50.297Z\&quot; agent=\&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36\&quot; etag=\&quot;-HzyQrBmOm1BBi3Kbblc\&quot; version=\&quot;20.2.2\&quot; type=\&quot;google\&quot;&gt;&lt;diagram id=\&quot;rtI5oX9UaKnuX4kORaYA\&quot; name=\&quot;Página-1\&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}"></div>
  <script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>
  </body>
  </html>
   <em>Event precedence</em> </center><h3><a class="anchor" id="q_os_operational_states"></a>
Additional operational states</h3>
<p >Each task has independent operating states from those globally controlled by the scheduler. These states can be handled by the application writer to modify the event flow to the task and consequently, affect the transition to the <code>qReady</code> global state. These states are described as follows:</p>
<ul>
<li><code>qAwake</code> : In this state, the task is conceptually in an alert mode, handling most of the available events. This operational state is available when the <code>SHUTDOWN</code> bit is set, allowing the next operational states to be available:<ul>
<li><code>qEnabled</code> : The task can catch all the events. This operational state is available when the <code>ENABLE</code> bit is set.</li>
<li><code>qDisabled</code> : In this state, the time events will be discarded. This operational state is available when the <code>ENABLE</code> bit is cleared.</li>
</ul>
</li>
<li><code>qAsleep</code> : Task operability is put into a deep doze mode, so the task can not be triggered by the lower precedence events. This operational state is available when the <code>SHUTDOWN</code> bit is cleared. The task can exit from this operational state when it receives a high precedence event (a queued notification) or using the <a class="el" href="group__qtaskmanip.html#ga5d9970617573cd8c14ed9a905d9c6a3a" title="Set the task operational state.">qTask_Set_State()</a> API.</li>
</ul>
<p >The figure below shows a better representation of how the event flow can be affected by these operational states.</p>
<center>  
  <!DOCTYPE html>
  <html>
  <head>
  <title>operationalstates</title>
  <meta charset="utf-8"/>
  </head>
  <body><div class="mxgraph" style="max-width:150%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;zoom&quot;:1.45,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2022-10-18T13:25:47.962Z\&quot; agent=\&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36\&quot; etag=\&quot;9dMBppV9Mj4qN3SqXlf-\&quot; version=\&quot;20.2.2\&quot; type=\&quot;google\&quot;&gt;&lt;diagram id=\&quot;FMHORikkxHPTSQ5eLvpY\&quot; name=\&quot;Página-1\&quot;&gt;7VrbcqM4EP0aP8bFHfsxdpLNQ+ZS69nKzKMMslGNQA7It/n6bYEAgyDGjokrUyGpMmokIfqcPpIaBuY03P0To1XwhfmYDgzN3w3Mu4Fh6KZuw4+w7KVFN0aZZRkTX9pKw4z8wdKoSeua+DipVOSMUU5WVaPHogh7vGJDccy21WoLRqt3XaElVgwzD1HV+kx8HuSP4YzLC4+YLAN565HhZhdClFeWT5IEyGfbA5N5PzCnMWM8Owt3U0yF93K/ZO0eWq4WA4txxLs0eJruX6I/X54Z5+bE+7EO1t+8G9nLBtG1fODbZB95Qcwitk4GhkOh78k8FuPne+kU52UtBj1ZsIjfJClkt1BB11aA+6S8DmdL+fvZzYfrpt1iVO5hxGwd+ViwTIfL24BwPFshT1zdgiqALeAhlZcXhNIpoyyGcsQiqDRJeMx+49w4MMyRJv7ksNvsMzkAXZYfUEioUJlHTDeYEw8VXeeBa+RNM5XRteJpNjjmeNcaWHoRriB0mIWYx3uoIhtYIxnhUuPMPOK3h4IhbcGBVui61AokRWpZ9F3GMZzIUD4hrA0lrHMcxfNfhiK54WWN14C+NMNw5+3ciRgnC4CGExYlB02yUb0XvzTNfXh46Mgv7Wx+jS5Er3GNXpYxtBWCjRv4Zdh5xYsTzFQIxlHy+xXotOPQvYKTCuqJkHRF+cLS4OZNJHaWpSvIWU4DclpPuFkNwvAWzA6RAd9Op/d2U2Rlx1GMczQSRsVTnAJyH2CZ3cDS+wLLblXxeScJN1oknJOwTbD/EunVL0SJuvZalnN97XUUWjyxLRYLv1WMPezjCAAyNLyBh0wUSMEZXEEmF1UVQUTJMoIixQvRTHgT/E9vpTkkvk9TpIEWJFo+pdXurNLyr/SJMDFovqDpJiiAhhh6mKwYEcOEsdkT+AdXTjVwnQ1jnUJZL8vwL6rHwJsIho9IiiFGCd/iRAwuZhxxNC+4U+y49COEayRYVQffZyXp2lW6uaMGuulG01py1BPb3AvPGIokjNPjzbO8j5KgUKqLYFFbdrmOioTZhITRV+CPjkMBlF+J03C3FAmZIabY47GIWHnKbkLsBShKTXzLntF+tiXcC0SsJ6sshbIgO+HKCabZtRnEFW6hfbvE9zJJO/meKQ8R21JgMd08aiq4mD3BMv6ExXCcmnJZ42vDki/LXsMFR/6tSBJCyaMoSYhXFaumOaDRp/lMI6p563hTKFGbt7Gv5B2P+vrAl3aD8OS2GFPYYG+q3Te5V97hu5iBSyjtWjrDcmrr24StYw/LVocJx1pHjnGkI47iJeZKRynaxWO/gQBqclOdugIWztdJh8XtlePLtoa1CLO1prVB04TU1/5Eb0ozvSnCattJ38Yj37pY5OEd4T/lVXH+SzQDJ2alu53sJS3sZeHDRauu1TcenePVqXVld4tXwBftD6rJFX3rkBVd0LXTxlV90QEn2QguKx5qhutz9ujAR2fstMnUqXx06zyxa6Ppe/7okCz76PIGpIn3Pw8Lv/IeRKFslJZOFUVwVYr1K06WLs2gfKWedVWRraeBjPNF1j1vUXSyyJq17at9RGTr4zLfQ2TVDOf919vJ0/1AhD4IiZmuteaEK4F3ZhrLA4Li+DOR1ZLIGve0SXdk+TCTbqrhavS2F1RzprPH/37cfXv++smzD8yzfEVQ8ExNBrkN04Lh9MWzDtnSgyWDJE0lddm+eCjd5zatGQqAyjl96OjFVC7m9RttqGujI5N7WvqOYwIuERQ+ccY/OpNnon+19akxqm+kHePMqdxSunJrXfW9Qu2QEf6r6XY1FrnO0LTH5VGlge2CK7Ti0M/k11gf6qZZXy4Obc2s3/i9+KamuhMSrqh43dj4ac8bP0dLPy1Ke0D8Yl8jpu9FocKCoqX6evTDvvG+1CvI+tdGefnI+27r9CQjFMuvXzOKlh8Rm/f/Aw==&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}"></div>
  <script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>
  </body>
  </html>
   <em>Event flow according operational states</em> </center><dl class="section remark"><dt>Remarks</dt><dd>Queued notifications are the only event that can wake up sleeping tasks </dd></dl>
<dl class="section note"><dt>Note</dt><dd>The <code>qAsleep</code> operational state overrides the <code>qEnabled</code> and <code>qDisabled</code> states.</dd></dl>
<h1><a class="anchor" id="q_critical"></a>
Critical sections</h1>
<p >Since the kernel is non-preemptive, the only critical section that must be handled are the shared resources accessed from the ISR context. Perhaps, the most obvious way of achieving mutual exclusion is to allow the kernel to disable interrupts before it enters their critical section and then, enable interrupts after it leaves its critical section.</p>
<p >By disabling interrupts, the CPU will be unable to change the current context. This guarantees that the currently running job can use a shared resource without another context accessing it. But, disabling interrupts, is a major undertaking. At best, the system will not be able to service interrupts for the time the current job is doing in its critical section, however, in QuarkTS, these critical sections are handled as quickly as possible.</p>
<p >Considering that the kernel is hardware-independent, the application writer should provide the necessary piece of code to enable and disable interrupts.</p>
<p >For this, the <a class="el" href="group__qcritical.html#gab60b5a86642800f3c4d733167d79dace" title="Set the hardware-specific code for global interrupt enable/disable. Setting this allows you to commun...">qCritical_SetInterruptsED()</a> API should be used. In this way, communication between ISR and tasks using queued notifications or data queues is performed safely.</p>
<p >In some systems, disabling the global IRQ flags is not enough, as they don't save/restore state of interrupt, so here, the <code>qUINT32_t</code> argument and return value in both functions (<code>Disabler</code> and <code>Restorer</code>) becomes relevant, because they can be used by the application writer to save and restore the current interrupt configuration. So, when a critical section is performed, the <code>Disabler</code>, in addition to disabling the interrupts, returns the current configuration to be retained by the kernel, later when the critical section finish, this retained value is passed to <code>Restorer</code> to bring back the saved configuration.</p>
<h1><a class="anchor" id="q_configmacros"></a>
Configuration macros</h1>
<p >Some OS features can be customized using a set of macros located in the header file <code>qconfig.h</code>. Here is the default configuration, followed by an explanation of each macro:</p>
<ul>
<li><code>Q_PRIORITY_LEVELS</code> : <em>Default:</em> <code>3</code>. The number of priorities available for application tasks.</li>
<li><code>Q_SETUP_TIME_CANONICAL</code> : <em>Default:</em> <code>0</code>(disabled). If enabled, the kernel assumes the timing base to 1mS(1KHz). So all time specifications for tasks and STimers must be set in milliseconds(mS). Also can be used to remove the floating-point operations when dealing with time. In some systems, can reduce memory usage.</li>
<li><code>Q_SETUP_TICK_IN_HERTZ</code> : <em>Default:</em> <code>0</code>(disabled). If enabled, the timing base will be taken as frequency(Hz) instead of period(S) by <a class="el" href="group__qtaskcreation.html#gac97ca3bd669135e0adcf07fcc2852313" title="Task Scheduler Setup. This function is required and must be called once in the application main threa...">qOS_Setup()</a> (In some systems, can reduce memory usage ).</li>
<li><code>Q_PRIO_QUEUE_SIZE</code> : <em>Default:</em> <code>10</code>. Size of the priority queue for notifications. This argument should be an integer number greater than zero. A zero value can be used to disable this functionality.</li>
<li><code>Q_PRESERVE_TASK_ENTRY_ORDER</code> : <em>Default:</em> <code>0</code>(disabled). If enabled, the kernel will preserve the tasks entry order every OS scheduling cycle.</li>
<li><code>Q_MEMORY_MANAGER</code> : <em>Default:</em> <code>1</code>(enabled). Used to enable or disable the <a class="el" href="q_memmang.html">Memory Management</a> extension.</li>
<li><code>Q_BYTE_ALIGNMENT</code> : <em>Default:</em> <code>8</code>. Used by the <a class="el" href="q_memmang.html">Memory Management</a> extension to perform the byte alignment.</li>
<li><code>Q_DEFAULT_HEAP_SIZE</code> : <em>Default:</em> <code>2048</code>. The total amount of heap size for the default memory pool.</li>
<li><code>Q_NOTIFICATION_SPREADER</code> : <em>Default:</em> <code>0</code>(disabled). Used to enable or disable the spread notification functionality.</li>
<li><code>Q_FSM</code> : <em>Default:</em> <code>1</code>(enabled). Used to enable or disable the Finite State Machine (FSM) extension.</li>
<li><code>Q_FSM_MAX_NEST_DEPTH</code> : <em>Default:</em> <code>5</code>. The max depth of nesting in Finite State Machines (FSM).</li>
<li><code>Q_FSM_MAX_TIMEOUTS</code> : <em>Default:</em> <code>3</code>. Max number of timeouts inside a timeout specification for the <a class="el" href="q_fsm.html">Finite State Machines (FSM)</a> extension.</li>
<li><code>Q_FSM_PS_SIGNALS_MAX</code> : <em>Default:</em> <code>8</code>. Max number of signals to subscribe for a Finite State Machine (FSM).</li>
<li><code>Q_FSM_PS_SUB_PER_SIGNAL_MAX</code> : <em>Default:</em> <code>4</code>. Max number of FSM subscribers per signal.</li>
<li><code>Q_QUEUES</code> : <em>Default:</em> <code>1</code>(enabled). Used to enable or disable the queues APIs for inter-task communication.</li>
<li><code>Q_TRACE_VARIABLES</code> : <em>Default:</em> <code>1</code>(enabled). Used to enable or disable debug and trace macros.</li>
<li><code>Q_DEBUGTRACE_BUFSIZE</code> : <em>Default:</em> <code>36</code>. The buffer size for debug and trace macros</li>
<li><code>Q_DEBUGTRACE_FULL</code> : <em>Default:</em> <code>1</code>(enabled). Used to enable or disable the extended output for trace macros.</li>
<li><code>Q_ATCLI</code> : <em>Default:</em> <code>1</code>(enabled). Used to enable or disable the <a class="el" href="q_atcli.html">AT Command Line Interface (CLI)</a> extension.</li>
<li><code>Q_TASK_COUNT_CYCLES</code> : <em>Default:</em> <code>0</code>(disabled). Used to enable or disable the counting of cycles of a task.</li>
<li><code>Q_TASK_EVENT_FLAGS</code> : <em>Default:</em> <code>1</code>(enabled). Used to enable or disable the task event flags.</li>
<li><code>Q_MAX_FTOA_PRECISION</code> : <em>Default:</em> <code>10</code>. The default precision used to perform float to ASCII conversions.</li>
<li><code>Q_ATOF_FULL</code> : <em>Default:</em> <code>0</code>(disabled). Used to enable or disable the scientific notation in ASCII to float conversions.</li>
<li><code>Q_ALLOW_SCHEDULER_RELEASE</code> : <em>Default:</em> <code>0</code>(disabled). Used to enable or disable the scheduler release functionality.</li>
<li><code>Q_RESPONSE_HANDLER</code> : <em>Default:</em> <code>1</code>(enabled). Used to enable or disable the response handler functionality.</li>
<li><code>Q_EDGE_CHECK_IOGROUPS</code> : <em>Default:</em> <code>1</code>(enabled). Used to enable or disable the edge check functionality for I/O groups.</li>
<li><code>Q_BYTE_SIZED_BUFFERS</code> : <em>Default:</em> <code>1</code>(enabled). Used to enable or disable the usage of Byte-sized buffers.</li>
<li><code>Q_USE_STDINT_H</code> : <em>Default:</em> <code>1</code>(enabled). Use the <code>stdint.h</code> header to define kernel data types. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
