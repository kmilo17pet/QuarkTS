<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="QuarkTS OS" />
<meta property="og:image" content="https://github.com/kmilo17pet/QuarkTS/raw/master/doc/quarktslogo.png" />
<meta property="og:description" content="An open-source OS for small embedded applications." />
<meta property="og:url" content="https://kmilo17pet.github.io/QuarkTS/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://github.com/kmilo17pet/QuarkTS/raw/master/doc/quarktslogo.png" />
<meta name="twitter:title" content="QuarkTS OS" />
<meta name="twitter:description" content="An open-source OS for small embedded applications." />
<!-- END twitter metadata -->
<title>OS: Getting started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/kmilo17pet/QuarkTS" class="github-corner" title="View source on GitHub" target="_blank" rel="noopener noreferrer">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="quarktslogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OS
   &#160;<span id="projectnumber">v7.3.3</span>
   </div>
   <div id="projectbrief">Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('q_gettingstarted.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Getting started </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#q_getos">Getting the OS</a><ul><li class="level2"><a href="#q_cloneos">Cloning QuarkTS</a></li>
<li class="level2"><a href="#q_submodule">Including QuarkTS as a git sub-module</a></li>
<li class="level2"><a href="#q_getqconfig">Get a copy of the OS configuration file</a></li>
</ul>
</li>
<li class="level1"><a href="#q_firststeps">First steps</a></li>
<li class="level1"><a href="#q_os_demo">Two simple demonstrative examples</a><ul><li class="level2"><a href="#q_os_example1">A simple scheduling</a></li>
<li class="level2"><a href="#q_os_example2">Using the task argument</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="q_getos"></a>
Getting the OS</h1>
<p >Download the latest release from the official repository :</p>
<p ><a href="https://github.com/kmilo17pet/QuarkTS/releases" style="font-weight:bold">QuarkTS Releases</a></p>
<p >Unpack the release package and add the sources files to your project.</p>
<h2><a class="anchor" id="q_cloneos"></a>
Cloning QuarkTS</h2>
<p >You only need to clone the <code>kernel</code> branch as follows:</p>
<div class="fragment"><div class="line">git clone -b kernel https://github.com/kmilo17pet/QuarkTS.git</div>
</div><!-- fragment --><h2><a class="anchor" id="q_submodule"></a>
Including QuarkTS as a git sub-module</h2>
<p >Add the OS kernel as a submodule to your project:</p>
<div class="fragment"><div class="line">git submodule add -b kernel https://github.com/kmilo17pet/QuarkTS.git &lt;destination path&gt;</div>
</div><!-- fragment --><p >Then, run the initialize command to fetch the code for the first time:</p>
<div class="fragment"><div class="line">git submodule update --init</div>
</div><!-- fragment --><p >To update the submodule to the latest just run:</p>
<div class="fragment"><div class="line">git submodule update --remote</div>
</div><!-- fragment --><h2><a class="anchor" id="q_getqconfig"></a>
Get a copy of the OS configuration file</h2>
<p >The file <code>qconfig.h</code> provides specific <a class="el" href="q_foundations.html#q_configmacros">Configuration macros</a> to customize several aspects of the OS. In order to build your solution with QuarkTS, you should provided your own copy of this configuration file. You can obtain a copy with the default configuration by issuing the following command:</p>
<div class="fragment"><div class="line">curl https://raw.githubusercontent.com/kmilo17pet/QuarkTS/master/src/config/qconfig.h -o &lt;destination path&gt;/qconfig.h</div>
</div><!-- fragment --><h1><a class="anchor" id="q_firststeps"></a>
First steps</h1>
<p >Include the source files to your project. Also, make sure you add a copy of the file <code>qconfig.h</code> and modify it according to your needs. Setup your compiler including the path of the OS directory. Include the header file <code><a class="el" href="_quark_t_s_8h_source.html">QuarkTS.h</a></code> and setup the instance of the kernel using the <a class="el" href="group__qtaskcreation.html#gac97ca3bd669135e0adcf07fcc2852313" title="Task Scheduler Setup. This function is required and must be called once in the application main threa...">qOS_Setup()</a> inside the main thread to initialize te kernel, specify the reference clock and the idle-task ( see <a class="el" href="q_foundations.html#q_timmingapproach">Timing Approach</a>). Additional configuration to the target compiler may be required to add the path to the directory of header files. The code below shows a common initialization procedure in the main source file.</p>
<p >File <code>main.c</code> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;QuarkTS.h&quot;</span></div>
<div class="line"><span class="preprocessor">#define TIMER_TICK       ( 0.001f ) </span><span class="comment">// 1ms</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> main( <span class="keywordtype">void</span> ) {</div>
<div class="line">    <span class="comment">//device startup with hardware-specific code</span></div>
<div class="line">    HardwareSetup();</div>
<div class="line">    Configure_Periodic_Timer_Interrupt_1ms();</div>
<div class="line">    <span class="comment">//end of device startup with hardware-specific code</span></div>
<div class="line">    <a class="code hl_function" href="group__qtaskcreation.html#gac97ca3bd669135e0adcf07fcc2852313">qOS_Setup</a>( NULL , TIMER_TICK , IdleTask_Callback );</div>
<div class="line">    <span class="comment">// TODO: add Tasks to the scheduler scheme and run the OS</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__qtaskcreation_html_gac97ca3bd669135e0adcf07fcc2852313"><div class="ttname"><a href="group__qtaskcreation.html#gac97ca3bd669135e0adcf07fcc2852313">qOS_Setup</a></div><div class="ttdeci">qBool_t qOS_Setup(const qGetTickFcn_t tFcn, const qTimingBase_t t, qTaskFcn_t idleCallback)</div><div class="ttdoc">Task Scheduler Setup. This function is required and must be called once in the application main threa...</div><div class="ttdef"><b>Definition:</b> qkernel.c:126</div></div>
</div><!-- fragment --><p >In the above code, the following considerations should be taken:</p><ul>
<li>The function <a class="el" href="group__qtaskcreation.html#gac97ca3bd669135e0adcf07fcc2852313" title="Task Scheduler Setup. This function is required and must be called once in the application main threa...">qOS_Setup()</a> must be called before any interaction with the OS.</li>
<li>The procedure <code>HardwareSetup()</code> should be a function with all the hardware instructions needed to initialize the target system.</li>
<li>The procedure <code>Configure_Periodic_Timer_Interrupt_1ms()</code> should be a function with all the hardware instructions needed to initialize and enable a timer with an overflow tick of one millisecond.</li>
</ul>
<p >Tasks can be later added to the scheduling scheme by simply calling <a class="el" href="group__qtaskcreation.html#ga261c858990773b834e8129940ceef1e2" title="Add a task to the scheduling scheme. The task is scheduled to run every t seconds,...">qOS_Add_Task()</a> or any of the other available APIs for specific purpose tasks.</p>
<h1><a class="anchor" id="q_os_demo"></a>
Two simple demonstrative examples</h1>
<h2><a class="anchor" id="q_os_example1"></a>
A simple scheduling</h2>
<p >This example demonstrates a simple environment setup for multiple tasks. Initially, only <code>task1</code> and <code>task2</code> are enabled. <code>task1</code> runs every 2 seconds 10 times and then stops. <code>task2</code> runs every 3 seconds indefinitely. <code>task1</code> enables <code>task3</code> at its first run. <code>task3</code> run every 5 seconds. <code>task1</code> disables <code>task3</code> on its last iteration and change <code>task2</code> to run every 1/2 seconds. In the end, <code>task2</code> is the only task running every 1/2 seconds.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;BSP.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;QuarkTS.h&quot;</span></div>
<div class="line"><span class="preprocessor">#define TIMER_TICK       ( 0.001f )   </span><span class="comment">/* 1ms */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structq_task__t.html">qTask_t</a> task1, task2, task3; <span class="comment">/*task nodes*/</span></div>
<div class="line"><span class="comment">/*==================================================================*/</span></div>
<div class="line"><span class="keywordtype">void</span> interrupt Timer0_ISR( <span class="keywordtype">void</span> ) {</div>
<div class="line">    <a class="code hl_function" href="group__qclock.html#gacdc3d27983dcc08e28d9eb9844a55c53">qClock_SysTick</a>();</div>
<div class="line">}</div>
<div class="line"><span class="comment">/*==================================================================*/</span></div>
<div class="line"><span class="keywordtype">void</span> Task1_Callback( <a class="code hl_struct" href="structq_event__t.html">qEvent_t</a> e ) {</div>
<div class="line">    BSP_UART1_WriteString( <span class="stringliteral">&quot;Task1&quot;</span> );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ( e-&gt;<a class="code hl_variable" href="structq_event__t.html#a7b0ca3c3b637735eeee1f1e9d1105726">FirstIteration</a> ) {</div>
<div class="line">        <a class="code hl_define" href="group__qtaskmanip.html#gae5b5bcd7257f31ec290b600fe306adbe">qTask_Resume</a>( &amp;Task3 );</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> ( e-&gt;<a class="code hl_variable" href="structq_event__t.html#af000312a956c600f57074345a75536bf">LastIteration</a> ) {</div>
<div class="line">        <a class="code hl_define" href="group__qtaskmanip.html#ga1211609f7dba8749ae31aa73a8b072e6">qTask_Suspend</a>( &amp;Task3 );</div>
<div class="line">        <a class="code hl_function" href="group__qtaskmanip.html#ga27aa23ec76dae5afb4c1a4d8b8d8e256">qTask_Set_Time</a>( &amp;Task2, 0.5 );</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="comment">/*==================================================================*/</span></div>
<div class="line"><span class="keywordtype">void</span> Task2_Callback( <a class="code hl_struct" href="structq_event__t.html">qEvent_t</a> e ) {</div>
<div class="line">    BSP_UART1_WriteString( <span class="stringliteral">&quot;Task2&quot;</span> );</div>
<div class="line">}</div>
<div class="line"><span class="comment">/*==================================================================*/</span></div>
<div class="line"><span class="keywordtype">void</span> Task3_Callback( <a class="code hl_struct" href="structq_event__t.html">qEvent_t</a> e ) {</div>
<div class="line">    BSP_UART1_WriteString( <span class="stringliteral">&quot;Task3&quot;</span> );</div>
<div class="line">}</div>
<div class="line"><span class="comment">/*==================================================================*/</span></div>
<div class="line"><span class="keywordtype">int</span> main( <span class="keywordtype">void</span> ) {</div>
<div class="line">    HardwareSetup();  <span class="comment">/*hardware initialization function*/</span></div>
<div class="line">    <span class="comment">/*function to fire an interrupt at 1ms - timer tick*/</span></div>
<div class="line">    Configure_Periodic_Timer0_Interrupt_1ms();</div>
<div class="line">    </div>
<div class="line">    <a class="code hl_function" href="group__qtaskcreation.html#gac97ca3bd669135e0adcf07fcc2852313">qOS_Setup</a>( NULL, TIMER_TICK, NULL );</div>
<div class="line">    <a class="code hl_function" href="group__qtaskcreation.html#ga261c858990773b834e8129940ceef1e2">qOS_Add_Task</a>( &amp;Task1, Task1_Callback, 50, 2.0f, 10, <a class="code hl_define" href="group__qtypes.html#ga1743f4a545347fa50ab81f1e4e21b095">qEnabled</a>, NULL );</div>
<div class="line">    <a class="code hl_function" href="group__qtaskcreation.html#ga261c858990773b834e8129940ceef1e2">qOS_Add_Task</a>( &amp;Task2, Task2_Callback, 50, 3.0f, <a class="code hl_define" href="group__qtaskcreation.html#gae3758e719245db560b090d90fce96301">qPeriodic</a>, <a class="code hl_define" href="group__qtypes.html#ga1743f4a545347fa50ab81f1e4e21b095">qEnabled</a>, NULL );</div>
<div class="line">    <a class="code hl_function" href="group__qtaskcreation.html#ga261c858990773b834e8129940ceef1e2">qOS_Add_Task</a>( &amp;Task2, Task3_Callback, 50, 5.0f, <a class="code hl_define" href="group__qtaskcreation.html#gae3758e719245db560b090d90fce96301">qPeriodic</a>, <a class="code hl_define" href="group__qtypes.html#ga269b67aecf99613cea9e19c1c20a3037">qDisabled</a>, NULL );</div>
<div class="line">    <a class="code hl_function" href="group__qtaskcreation.html#gabd4b43371d39c5eb82b87f0900f2895a">qOS_Run</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__qclock_html_gacdc3d27983dcc08e28d9eb9844a55c53"><div class="ttname"><a href="group__qclock.html#gacdc3d27983dcc08e28d9eb9844a55c53">qClock_SysTick</a></div><div class="ttdeci">void qClock_SysTick(void)</div><div class="ttdoc">Feed the system tick.</div><div class="ttdef"><b>Definition:</b> qclock.c:94</div></div>
<div class="ttc" id="agroup__qtaskcreation_html_ga261c858990773b834e8129940ceef1e2"><div class="ttname"><a href="group__qtaskcreation.html#ga261c858990773b834e8129940ceef1e2">qOS_Add_Task</a></div><div class="ttdeci">qBool_t qOS_Add_Task(qTask_t *const Task, qTaskFcn_t callbackFcn, const qPriority_t p, const qTime_t t, const qIteration_t n, const qState_t init, void *arg)</div><div class="ttdoc">Add a task to the scheduling scheme. The task is scheduled to run every t seconds,...</div><div class="ttdef"><b>Definition:</b> qkernel.c:411</div></div>
<div class="ttc" id="agroup__qtaskcreation_html_gabd4b43371d39c5eb82b87f0900f2895a"><div class="ttname"><a href="group__qtaskcreation.html#gabd4b43371d39c5eb82b87f0900f2895a">qOS_Run</a></div><div class="ttdeci">qBool_t qOS_Run(void)</div><div class="ttdoc">Executes the scheduling scheme. It must be called once after the task pool has been defined.</div><div class="ttdef"><b>Definition:</b> qkernel.c:676</div></div>
<div class="ttc" id="agroup__qtaskcreation_html_gae3758e719245db560b090d90fce96301"><div class="ttname"><a href="group__qtaskcreation.html#gae3758e719245db560b090d90fce96301">qPeriodic</a></div><div class="ttdeci">#define qPeriodic</div><div class="ttdoc">A directive indicating that the task will run every time its timeout has expired.</div><div class="ttdef"><b>Definition:</b> qkernel.h:80</div></div>
<div class="ttc" id="agroup__qtaskmanip_html_ga1211609f7dba8749ae31aa73a8b072e6"><div class="ttname"><a href="group__qtaskmanip.html#ga1211609f7dba8749ae31aa73a8b072e6">qTask_Suspend</a></div><div class="ttdeci">#define qTask_Suspend(Task)</div><div class="ttdoc">Put the task into a disabled state.</div><div class="ttdef"><b>Definition:</b> qtasks.h:533</div></div>
<div class="ttc" id="agroup__qtaskmanip_html_ga27aa23ec76dae5afb4c1a4d8b8d8e256"><div class="ttname"><a href="group__qtaskmanip.html#ga27aa23ec76dae5afb4c1a4d8b8d8e256">qTask_Set_Time</a></div><div class="ttdeci">qBool_t qTask_Set_Time(qTask_t *const Task, const qTime_t tValue)</div><div class="ttdoc">Set/Change the Task execution interval.</div><div class="ttdef"><b>Definition:</b> qtasks.c:95</div></div>
<div class="ttc" id="agroup__qtaskmanip_html_gae5b5bcd7257f31ec290b600fe306adbe"><div class="ttname"><a href="group__qtaskmanip.html#gae5b5bcd7257f31ec290b600fe306adbe">qTask_Resume</a></div><div class="ttdeci">#define qTask_Resume(Task)</div><div class="ttdoc">Put the task into an enabled state.</div><div class="ttdef"><b>Definition:</b> qtasks.h:549</div></div>
<div class="ttc" id="agroup__qtypes_html_ga1743f4a545347fa50ab81f1e4e21b095"><div class="ttname"><a href="group__qtypes.html#ga1743f4a545347fa50ab81f1e4e21b095">qEnabled</a></div><div class="ttdeci">#define qEnabled</div><div class="ttdoc">A state value that enables a task.</div><div class="ttdef"><b>Definition:</b> qtypes.h:167</div></div>
<div class="ttc" id="agroup__qtypes_html_ga269b67aecf99613cea9e19c1c20a3037"><div class="ttname"><a href="group__qtypes.html#ga269b67aecf99613cea9e19c1c20a3037">qDisabled</a></div><div class="ttdeci">#define qDisabled</div><div class="ttdoc">A state value that disables a task.</div><div class="ttdef"><b>Definition:</b> qtypes.h:172</div></div>
<div class="ttc" id="astructq_event__t_html"><div class="ttname"><a href="structq_event__t.html">qEvent_t</a></div><div class="ttdoc">The task argument with all the regarding information of the task execution.</div><div class="ttdef"><b>Definition:</b> qtasks.h:162</div></div>
<div class="ttc" id="astructq_event__t_html_a7b0ca3c3b637735eeee1f1e9d1105726"><div class="ttname"><a href="structq_event__t.html#a7b0ca3c3b637735eeee1f1e9d1105726">qEvent_t::FirstIteration</a></div><div class="ttdeci">qBool_t FirstIteration</div><div class="ttdoc">Indicates whether current pass is the first iteration of the task. This flag will be only set when ti...</div><div class="ttdef"><b>Definition:</b> qtasks.h:193</div></div>
<div class="ttc" id="astructq_event__t_html_af000312a956c600f57074345a75536bf"><div class="ttname"><a href="structq_event__t.html#af000312a956c600f57074345a75536bf">qEvent_t::LastIteration</a></div><div class="ttdeci">qBool_t LastIteration</div><div class="ttdoc">Indicates whether current pass is the last iteration of the task. This flag will be only set when tim...</div><div class="ttdef"><b>Definition:</b> qtasks.h:201</div></div>
<div class="ttc" id="astructq_task__t_html"><div class="ttname"><a href="structq_task__t.html">qTask_t</a></div><div class="ttdoc">A task node object.</div><div class="ttdef"><b>Definition:</b> qtasks.h:268</div></div>
</div><!-- fragment --><h2><a class="anchor" id="q_os_example2"></a>
Using the task argument</h2>
<p >When adding tasks, they can accept a parameter of type pointer to void <code>void*</code> also called the storage pointer. This parameter could be used for multiple applications, including storage, task identification, duplication removal and others. The following example shows the usage of this argument to avoid callback duplication among tasks with the same behavior.</p>
<p >Consider a scenario where you have to build a digital controller for several physical variables, for example, a PID controller for temperature, humidity and light. The PID algorithm will be the same for all variables. The only difference will be the variable input, the controlled output action and the PID gains. In this case, each of the PID tasks will utilize the same callback methods. The only difference will be the I/O parameters (specific for each PID controller).</p>
<p >Let’s define a PID data structure with the I/O variables and gains.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">     <span class="keywordtype">float</span> yt; <span class="comment">/*Measured variable (Controller Input)*/</span></div>
<div class="line">     <span class="keywordtype">float</span> ut; <span class="comment">/*Controlled variable (Controller Output)*/</span></div>
<div class="line">     <span class="keywordtype">float</span> ie; <span class="comment">/*Accumulated error*/</span></div>
<div class="line">     <span class="keywordtype">float</span> pe; <span class="comment">/*Previous error*/</span></div>
<div class="line">     <span class="keywordtype">float</span> dt; <span class="comment">/*Controller Time Step*/</span></div>
<div class="line">     <span class="keywordtype">float</span> sp; <span class="comment">/*Set-Point*/</span></div>
<div class="line">     <span class="keywordtype">float</span> Kc, Ki, Kd; <span class="comment">/*PID Gains*/</span></div>
<div class="line"> } PID_Params_t;</div>
<div class="line"> </div>
<div class="line"> PID_Params_t TemperatureControl = {</div>
<div class="line">    0.0f, 0.0f, 0.0f, 0.0f, <span class="comment">/*Initial IO state of yt and ut*/</span></div>
<div class="line">    1.5f, <span class="comment">/*time step*/</span></div>
<div class="line">    28.5f, <span class="comment">/*Set-Point*/</span></div>
<div class="line">    0.89f, 0.122f, 0.001f <span class="comment">/*Kc, Ki, Kd*/</span></div>
<div class="line"> };</div>
<div class="line"> PID_Params_t HumidityControl= {</div>
<div class="line">    0.0f, 0.0f, 0.0f, 0.0f, <span class="comment">/*Initial IO state of yt and ut*/</span></div>
<div class="line">    1.0f, <span class="comment">/*time step*/</span></div>
<div class="line">    60.0f, <span class="comment">/*Set-Point*/</span></div>
<div class="line">    2.5f, 0.2354f, 0.0015f <span class="comment">/*Kc, Ki, Kd*/</span></div>
<div class="line"> };</div>
<div class="line"> PID_Params_t LightControl= {</div>
<div class="line">    0.0f, 0.0f, 0.0f, 0.0f, <span class="comment">/*Initial IO state of yt and ut*/</span></div>
<div class="line">    0.5f, <span class="comment">/*time step*/</span></div>
<div class="line">    45.0f, <span class="comment">/*Set-Point*/</span></div>
<div class="line">    5.36f, 0.0891f, 0.0f <span class="comment">/*Kc, Ki, Kd*/</span></div>
<div class="line"> };</div>
</div><!-- fragment --><p >A task will be added to the scheme to collect the sensor data and apply the respective control output.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="group__qtaskcreation.html#ga261c858990773b834e8129940ceef1e2">qOS_Add_Task</a>( &amp;IO_TASK , IO_TASK_Callback , <a class="code hl_define" href="group__qtaskcreation.html#ga13bec7f4284d45c97f512c83ed9b7744">qMedium_Priority</a> , 0.1, <a class="code hl_define" href="group__qtaskcreation.html#gae3758e719245db560b090d90fce96301">qPeriodic</a>, <a class="code hl_define" href="group__qtypes.html#ga1743f4a545347fa50ab81f1e4e21b095">qEnabled</a> , <span class="stringliteral">&quot;iotask&quot;</span>);</div>
<div class="ttc" id="agroup__qtaskcreation_html_ga13bec7f4284d45c97f512c83ed9b7744"><div class="ttname"><a href="group__qtaskcreation.html#ga13bec7f4284d45c97f512c83ed9b7744">qMedium_Priority</a></div><div class="ttdeci">#define qMedium_Priority</div><div class="ttdoc">A macro directive to indicate the medium priority level.</div><div class="ttdef"><b>Definition:</b> qkernel.h:74</div></div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">void</span> IO_TASK_Callback( <a class="code hl_struct" href="structq_event__t.html">qEvent_t</a> e ) {</div>
<div class="line">    TemperatureControl.yt = SampleTemperatureSensor();</div>
<div class="line">    HumidityControl.yt = SampleHumiditySensor();</div>
<div class="line">    LightControl.yt = SampleLightSensor();</div>
<div class="line">    WriteTemperatureActuatorValue( TemperatureControl.ut );</div>
<div class="line">    WriteHumidityActuatorValue( HumidityControl.ut );</div>
<div class="line">    WriteLightActuatorValue( LightControl.ut );</div>
<div class="line">}</div>
</div><!-- fragment --><p >Then, three different tasks are created to apply the respective PID controller. Note that these tasks refer to the same callback method and we assign pointers to the respective variables.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="group__qtaskcreation.html#ga261c858990773b834e8129940ceef1e2">qOS_Add_Task</a>( &amp;TEMPERATURE_CONTROL_TASK, PIDControl_Callback,</div>
<div class="line">              <a class="code hl_define" href="group__qtaskcreation.html#ga32c8bd0870414e10a6e72b743627da5a">qHigh_Priority</a>, TemperatureControl.dt ,</div>
<div class="line">              <a class="code hl_define" href="group__qtaskcreation.html#gae3758e719245db560b090d90fce96301">qPeriodic</a>, <a class="code hl_define" href="group__qtypes.html#ga1743f4a545347fa50ab81f1e4e21b095">qEnabled</a>, &amp;TemperatureControl );</div>
<div class="line"><a class="code hl_function" href="group__qtaskcreation.html#ga261c858990773b834e8129940ceef1e2">qOS_Add_Task</a>( &amp;HUMIDITY_CONTROL_TASK, PIDControl_Callback,</div>
<div class="line">              <a class="code hl_define" href="group__qtaskcreation.html#ga32c8bd0870414e10a6e72b743627da5a">qHigh_Priority</a>, HumidityControl.dt,</div>
<div class="line">              <a class="code hl_define" href="group__qtaskcreation.html#gae3758e719245db560b090d90fce96301">qPeriodic</a>, <a class="code hl_define" href="group__qtypes.html#ga1743f4a545347fa50ab81f1e4e21b095">qEnabled</a>, &amp;HumidityControl );</div>
<div class="line"><a class="code hl_function" href="group__qtaskcreation.html#ga261c858990773b834e8129940ceef1e2">qOS_Add_Task</a>( &amp;LIGHT_CONTROL_TASK, PIDControl_Callback,</div>
<div class="line">              <a class="code hl_define" href="group__qtaskcreation.html#ga32c8bd0870414e10a6e72b743627da5a">qHigh_Priority</a>, LightControl.dt,</div>
<div class="line">              <a class="code hl_define" href="group__qtaskcreation.html#gae3758e719245db560b090d90fce96301">qPeriodic</a>, <a class="code hl_define" href="group__qtypes.html#ga1743f4a545347fa50ab81f1e4e21b095">qEnabled</a>, &amp;LightControl );</div>
<div class="ttc" id="agroup__qtaskcreation_html_ga32c8bd0870414e10a6e72b743627da5a"><div class="ttname"><a href="group__qtaskcreation.html#ga32c8bd0870414e10a6e72b743627da5a">qHigh_Priority</a></div><div class="ttdeci">#define qHigh_Priority</div><div class="ttdoc">A macro directive to indicate the highest priority level.</div><div class="ttdef"><b>Definition:</b> qkernel.h:77</div></div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">void</span> PIDControl_Callback( <a class="code hl_struct" href="structq_event__t.html">qEvent_t</a> e ) {</div>
<div class="line">    <span class="keywordtype">float</span> Error, derivative;</div>
<div class="line">    <span class="comment">/* Obtain the reference to the specific PID controller</span></div>
<div class="line"><span class="comment">     * using the TaskData field from the qEvent structure</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    PID_Params_t *Controller = (PID_Params_t *)e-&gt;<a class="code hl_variable" href="structq_event__t.html#a191262c05958798bbb47391043170b2a">TaskData</a>;</div>
<div class="line">    <span class="comment">/*Compute the error*/</span></div>
<div class="line">    Error = Controller-&gt;sp - Controller-&gt;yt;</div>
<div class="line">    <span class="comment">/*Compute the accumulated error using backward integral approximation*/</span></div>
<div class="line">    Controller-&gt;ie += Error*Controller-&gt;dt;</div>
<div class="line">    <span class="comment">/*update and compute the derivative term*/</span></div>
<div class="line">    derivative = ( Error - Controller-&gt;pe )/Controller-&gt;dt;</div>
<div class="line">    <span class="comment">/*update the previous error*/</span></div>
<div class="line">    Controller-&gt;pe = Error;</div>
<div class="line">    <span class="comment">/*compute the pid control law*/</span></div>
<div class="line">    Controller-&gt;ut = Controller-&gt;Kc*Error + Controller-&gt;Ki*Controller-&gt;ie + Controller-&gt;Kd*derivative;</div>
<div class="line">}</div>
<div class="ttc" id="astructq_event__t_html_a191262c05958798bbb47391043170b2a"><div class="ttname"><a href="structq_event__t.html#a191262c05958798bbb47391043170b2a">qEvent_t::TaskData</a></div><div class="ttdeci">void * TaskData</div><div class="ttdoc">Task arguments defined at the time of its creation. (Storage-Pointer)</div><div class="ttdef"><b>Definition:</b> qtasks.h:167</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
